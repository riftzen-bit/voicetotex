<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; connect-src 'self' ws://127.0.0.1:*; style-src 'self' 'unsafe-inline'; img-src 'self' data:">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>VoiceToTex</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body data-state="loading">

  <!-- Titlebar -->
  <div class="titlebar">
    <span class="titlebar-title">VoiceToTex</span>
    <div class="titlebar-controls">
      <button type="button" class="titlebar-btn minimize" id="btn-minimize" aria-label="Minimize">&#x2500;</button>
      <button type="button" class="titlebar-btn close" id="btn-close" aria-label="Close">&#x2715;</button>
    </div>
  </div>

  <!-- Tab Bar -->
  <div class="tab-bar">
    <button type="button" class="tab-btn active" data-tab="studio">Studio</button>
    <button type="button" class="tab-btn" data-tab="transcripts">Transcripts</button>
    <button type="button" class="tab-btn" data-tab="settings">Settings</button>
  </div>

  <!-- Tab Content -->
  <div class="tab-content">

    <!-- Studio Tab -->
    <div id="tab-studio" class="tab-panel active">
      <div class="studio-card">
        <div class="waveform-wrapper">
          <canvas id="waveform" class="waveform-canvas"></canvas>
        </div>
        <div class="transport-bar">
          <div class="transport-left">
            <span class="state-dot"></span>
            <span class="state-label"></span>
            <span class="connection-indicator">
              <span class="connection-dot disconnected" id="connection-dot"></span>
              <span class="connection-label" id="connection-label">Disconnected</span>
            </span>
          </div>
          <button type="button" class="mic-btn" id="mic-btn" aria-label="Toggle recording">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <title>Microphone</title>
              <path d="M12 14a3 3 0 0 0 3-3V5a3 3 0 0 0-6 0v6a3 3 0 0 0 3 3zm5-3a5 5 0 0 1-10 0H5a7 7 0 0 0 6 6.92V21h2v-3.08A7 7 0 0 0 19 11h-2z"/>
            </svg>
          </button>
          <div class="transport-right">
            <span class="badge" id="lang-badge">Auto</span>
            <span class="badge" id="model-badge">large-v3-turbo</span>
            <span class="hotkey-hint">Ctrl+Shift+Space</span>
          </div>
        </div>
      </div>

      <div class="studio-info-strip">
        <div class="info-strip-item">
          <span class="info-strip-label">Input</span>
          <div class="track-meter"><span class="track-meter-fill" id="track-meter-input"></span></div>
        </div>
        <div class="info-strip-item">
          <span class="info-strip-label">AI</span>
          <div class="track-meter"><span class="track-meter-fill" id="track-meter-processing"></span></div>
        </div>
        <div class="info-strip-item">
          <span class="info-strip-label">Out</span>
          <div class="track-meter"><span class="track-meter-fill" id="track-meter-output"></span></div>
        </div>
        <div class="info-strip-sep"></div>
        <div class="info-strip-kv"><span>Mode</span><strong id="studio-hotkey-mode">Hold</strong></div>
        <div class="info-strip-kv"><span>Status</span><strong id="studio-state">Loading</strong></div>
        <div class="info-strip-kv"><span>Connection</span><strong id="studio-connection">Offline</strong></div>
      </div>

      <div id="transcript-preview" class="transcript-preview">
        <div class="transcript-preview-empty">Press Ctrl+Shift+Space to start recording</div>
      </div>
    </div>

    <!-- Transcripts Tab -->
    <div id="tab-transcripts" class="tab-panel">
      <div class="transcript-toolbar">
        <div class="transcript-toolbar-left">
          <h2 class="transcript-toolbar-title">Transcripts</h2>
          <span class="transcript-count" id="transcript-count"></span>
        </div>
        <div class="transcript-toolbar-right">
          <button type="button" class="toolbar-btn" id="btn-export">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
            Export
          </button>
        </div>
      </div>
      <div class="transcript-search-bar">
        <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        <input type="text" class="transcript-search-input" id="transcript-search" placeholder="Search transcripts...">
      </div>
      <div id="transcript-list" class="transcript-list">
        <div class="transcript-empty">Press Ctrl+Shift+Space to start recording</div>
      </div>
    </div>

    <!-- Settings Tab -->
    <div id="tab-settings" class="tab-panel">
      <div class="settings-body">

        <!-- Section: Recognition -->
        <div class="settings-group">
          <div class="settings-group-header">
            <h3 class="settings-group-title">Recognition</h3>
            <p class="settings-group-desc">Configure the speech recognition engine</p>
          </div>
          <div class="settings-group-body">
            <div class="settings-row">
              <div class="settings-row-info">
                <label class="settings-label" for="setting-model">Model</label>
                <span class="settings-description">Whisper model for transcription</span>
              </div>
              <select class="settings-select" id="setting-model">
                <option value="large-v3-turbo" selected>large-v3-turbo</option>
              </select>
            </div>
            <div class="settings-row">
              <div class="settings-row-info">
                <label class="settings-label" for="setting-language">Language</label>
                <span class="settings-description">Source language or auto-detect</span>
              </div>
              <select class="settings-select" id="setting-language">
                <option value="auto" selected>Auto-detect</option>
                <option value="vi">Vietnamese</option>
                <option value="en">English</option>
                <option value="es">Spanish</option>
                <option value="fr">French</option>
                <option value="de">German</option>
                <option value="it">Italian</option>
                <option value="pt">Portuguese</option>
                <option value="ja">Japanese</option>
                <option value="ko">Korean</option>
                <option value="zh">Chinese</option>
                <option value="ru">Russian</option>
                <option value="ar">Arabic</option>
              </select>
            </div>
            <div class="settings-row">
              <div class="settings-row-info">
                <label class="settings-label">Beam Size</label>
                <span class="settings-description">Higher = more accurate but slower</span>
              </div>
              <div class="range-row">
                <input type="range" class="settings-range" id="setting-beam" min="1" max="10" value="5">
                <span class="range-value" id="beam-value">5</span>
              </div>
            </div>
            <div class="settings-row">
              <div class="settings-row-info">
                <label class="settings-label" for="setting-initial-prompt">Initial Prompt</label>
                <span class="settings-description">Context hint for Whisper</span>
              </div>
              <input type="text" class="settings-input" id="setting-initial-prompt" placeholder="e.g. technical terms, names...">
            </div>
          </div>
        </div>

        <!-- Section: Input -->
        <div class="settings-group">
          <div class="settings-group-header">
            <h3 class="settings-group-title">Input</h3>
            <p class="settings-group-desc">Audio input and voice detection settings</p>
          </div>
          <div class="settings-group-body">
            <div class="settings-row">
              <div class="settings-row-info">
                <label class="settings-label" for="setting-device">Audio Device</label>
                <span class="settings-description">Microphone to use for recording</span>
              </div>
              <select class="settings-select" id="setting-device">
                <option value="default" selected>Default</option>
              </select>
            </div>
            <div class="settings-row">
              <div class="settings-row-info">
                <label class="settings-label">VAD Sensitivity</label>
                <span class="settings-description">Voice activity detection threshold</span>
              </div>
              <div class="range-row">
                <input type="range" class="settings-range" id="setting-vad" min="10" max="90" step="10" value="30">
                <span class="range-value" id="vad-value">0.3</span>
              </div>
            </div>
            <div class="settings-row">
              <div class="settings-row-info">
                <label class="settings-label">Noise Reduction</label>
                <span class="settings-description">Filter background noise</span>
              </div>
              <label class="toggle">
                <input type="checkbox" id="setting-noise-reduction" checked>
                <span class="toggle-track"></span>
              </label>
            </div>
          </div>
        </div>

        <!-- Section: Controls -->
        <div class="settings-group">
          <div class="settings-group-header">
            <h3 class="settings-group-title">Controls</h3>
            <p class="settings-group-desc">Hotkey and output configuration</p>
          </div>
          <div class="settings-group-body">
            <div class="settings-row">
              <div class="settings-row-info">
                <label class="settings-label">Output Mode</label>
                <span class="settings-description">How transcribed text is delivered</span>
              </div>
              <div class="radio-group">
                <input type="radio" name="output-mode" id="output-paste" value="paste" checked>
                <label for="output-paste">Paste</label>
                <input type="radio" name="output-mode" id="output-type" value="type">
                <label for="output-type">Type</label>
                <input type="radio" name="output-mode" id="output-copy" value="copy">
                <label for="output-copy">Copy Only</label>
              </div>
            </div>
            <div class="settings-row">
              <div class="settings-row-info">
                <label class="settings-label">Hotkey Mode</label>
                <span class="settings-description">Hold to talk or toggle on/off</span>
              </div>
              <div class="radio-group">
                <input type="radio" name="hotkey-mode" id="hotkey-toggle" value="toggle">
                <label for="hotkey-toggle">Toggle</label>
                <input type="radio" name="hotkey-mode" id="hotkey-hold" value="hold" checked>
                <label for="hotkey-hold">Hold</label>
              </div>
            </div>
            <div class="settings-row">
              <div class="settings-row-info">
                <label class="settings-label">Shortcut</label>
                <span class="settings-description">Global keyboard shortcut</span>
              </div>
              <div class="hotkey-recorder" id="hotkey-recorder" tabindex="0">
                <span class="hotkey-recorder-keys" id="hotkey-recorder-keys">Ctrl+Shift+Space</span>
                <span class="hotkey-recorder-hint">Click to change</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Danger Zone -->
        <div class="settings-group settings-group-danger">
          <div class="settings-group-header">
            <h3 class="settings-group-title">Data</h3>
            <p class="settings-group-desc">Manage your transcription history</p>
          </div>
          <div class="settings-group-body">
            <div class="settings-row">
              <div class="settings-row-info">
                <label class="settings-label">Clear History</label>
                <span class="settings-description">Permanently delete all saved transcripts</span>
              </div>
              <button type="button" class="btn-danger" id="btn-clear-history-settings">Clear All</button>
            </div>
          </div>
        </div>

      </div>
    </div>

  </div><!-- end tab-content -->

  <!-- Loading Overlay -->
  <div id="loading-overlay" class="loading-overlay">
    <div class="spinner"></div>
    <span class="loading-text">Loading model...</span>
    <div class="progress-bar">
      <div class="progress-fill" id="progress-fill"></div>
    </div>
  </div>

  <!-- Crash Recovery Overlay -->
  <div id="crash-overlay" class="crash-overlay">
    <div class="crash-content">
      <div class="crash-icon">&#x26A0;</div>
      <div class="crash-title">Backend Disconnected</div>
      <div class="crash-message" id="crash-message">The transcription engine stopped unexpectedly.</div>
      <button type="button" class="crash-retry-btn" id="btn-crash-retry">Retry Connection</button>
    </div>
  </div>

  <script type="module" src="js/app.js"></script>
</body>
</html>
